---
- import_role:
    name: common
    tasks_from: load-config
  vars:
    file: smb.yml

- name: Add volumes to container options.
  set_fact:
    volumes: "{{ volumes }} + [ '{{ item.value.path }}:{{ item.value.path }}' ]"
  loop: "{{ config.shares | dict2items }}"

- name: Add smb shares to entrypoint options.
  set_fact:
    options: "{{ options }} + [ '-s \"{{ item.key }};{{ item.value.path }};{{ item.value.browsable }};{{ item.value.readonly }};{{ item.value.guest }};{{ item.value.users }};{{ item.value.admins }};{{ item.value.writelist }};{{ item.value.comment }}\"' ]"
  loop: "{{ config.shares | dict2items }}"

- name: Add smb users to entrypoint options.
  set_fact:
    options: "{{ options }} + [ '-u \"{{ item.key }};{{ item.value.smbpsw }};{{ item.value.userid }};{{ item.value.groupid }}\"' ]"
  loop: "{{ config.users | dict2items }}"

- set_fact:
    volumes: "{{ volumes | list }}"
    options: "{{ options | list }}"

# - name: Print the smb options to the console.
#   debug: var=options
